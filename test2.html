<html lang="en">
    <head>
    
    
        <title>mediaDevices.enumerateDevices()</title>
        
        <style>
            h1 {
                margin: 0 0 24px 0;
            }
            select {
                width: 150px;
            }
            video {
                margin: 10px 0 0 0;
            }
        </style>
        
    </head>
    
    <body>
        
        <div id="container">
            <div class="select">
                <label for="audioSource">Audio source: </label><select id="audioSource"><option value="default">Par défaut - Headset Microphone (HyperX Virtual Surround Sound) (0951:16a4)</option><option value="communications">Communications - Headset Microphone (HyperX Virtual Surround Sound) (0951:16a4)</option><option value="4098fed25896ed28235dd52b062676564d1ff8a0813d25f4782997e49415b8dd">Microphone Array (Intel® Smart Sound Technology (Intel® SST))</option><option value="e474f5f0dfe793220c23c9c278617175d1350261e845c6d55d7a9ae580fffed3">Headset Microphone (HyperX Virtual Surround Sound) (0951:16a4)</option></select>
            </div>
            
            <div class="select">
                <label for="videoSource">Video source: </label><select id="videoSource"><option value="26253550c36691e902a0c3931c825c06299202b890fe1bbb9573ef3a26c89c59">HP HD Camera (04f2:b669)</option></select>
            </div>
            
            <video id="camVideo" autoplay="" muted="" playsinline=""></video>
        </div>

        <script>
            const camVideo = document.querySelector('#camVideo');
            const videoCamSelect = document.querySelector('#videoSource');

            // Comportement de la caméra
            videoCamSelect.onchange = findStream;

            // Traitement de la caméra
            findStream()
                .then(() => navigator.mediaDevices.enumerateDevices())
                .then(getDevicesOptions)
                .catch(handleErrorVideo);

            function getDevicesOptions(deviceInfos) {
                window.deviceInfos = deviceInfos;
                for (const deviceInfo of deviceInfos) {
                    if (deviceInfo.kind === 'videoinput') {
                        const option = document.createElement('option');
                        option.value = deviceInfo.deviceId;
                        option.text = `Camera ${videoCamSelect.length + 1}`;
                        videoCamSelect.appendChild(option);
                    }
                }
            }

            function findStream() {
                if (window.stream) {
                    window.stream.getTracks().forEach(track => {
                    track.stop();
                    });
                }
                const videoSource = videoCamSelect.value;
                const videoConstraints = { video: true };

                return navigator.mediaDevices.getUserMedia(videoConstraints).
                    then(loadStream)
                    .catch(handleErrorVideo);
            }

            function loadStream(stream) {
            window.stream = stream;
            videoCamSelect.selectedIndex = [...videoCamSelect.options].
                findIndex(option => option.text === stream.getVideoTracks()[0].label);
                camVideo.srcObject = stream;
            }

            function handleErrorVideo() {
                camVideo.html += "<p>Erreur lors de la détection de caméra</p>"
            }
        </script>
    </body>
</html>
